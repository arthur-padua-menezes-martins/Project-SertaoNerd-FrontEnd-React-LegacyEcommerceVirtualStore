/*basic modules************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
import React, { useState } from 'react'

/*redux************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
import { connect } from 'react-redux'
import actions from '../../redux/actions/index.js'

/*components************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
import CheckoutPageTable from '../../Components/Table/CheckoutPage/index.js'
import CheckoutPageList from '../../Components/List/CheckoutPage/index.js'

/*styled components************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
import {
    StyledContainerCheckoutPage,
    StyledContainerCheckoutPageLeft,
    StyledContainerCheckoutPageRight, StyledContainerCheckoutPageClickToOpenPageRight, StyledSpanClickToOpenPageRight
} from './styles.js'

/*helpers************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
import { dollarPayment, reaisPayment } from '../../helpers/format/index.js'

/*main function************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
function CheckoutPage(props) {

    /*state************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
    var [clickToOpen, setClickToOpen] = useState(true)

    /*var's************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
    var
        cartTotal = `${((props.cart || []).reduce((acumulator, item) => acumulator + Number(item.unitaryValue) * Number(item.quantity), 0)).toFixed(2) || '...'}`,
        freteValue = `${typeof props.frete.selectedFrete !== 'undefined' && props.frete.selectedFrete.Valor || '---'}`,
        payment = freteValue !== '---' ? (Number(cartTotal) + dollarPayment(freteValue)).toFixed(2) : '---'




    /*return************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
    return (
        <StyledContainerCheckoutPage>


            { window.innerWidth <= 719 && (
                <StyledContainerCheckoutPageClickToOpenPageRight onClick={() => setClickToOpen(!clickToOpen)}>

                    <StyledSpanClickToOpenPageRight>

                        <span >
                            <i style={{ transition: 'all 0.2s', transform: clickToOpen ? 'rotate(180deg)' : 'rotate(0deg)' }} className="fas fa-angle-down"></i>
                        </span>

                        <span>
                            {clickToOpen ? 'ocultar o resumo da compra' : 'exibir o resumo da compra'}
                        </span>

                    </StyledSpanClickToOpenPageRight>

                    <StyledSpanClickToOpenPageRight value>
                        { !props.whatsapp.whatsappVersion ? reaisPayment(payment) : reaisPayment(cartTotal) }
                    </StyledSpanClickToOpenPageRight>

                </StyledContainerCheckoutPageClickToOpenPageRight>
            )}


            <StyledContainerCheckoutPageLeft>

                <CheckoutPageList />

            </StyledContainerCheckoutPageLeft>


            <StyledContainerCheckoutPageRight open={clickToOpen}>

                <CheckoutPageTable />

            </StyledContainerCheckoutPageRight>


        </StyledContainerCheckoutPage>
    )

}

const mapStateToProps = (state, ownProps) => ({
    ...state,
    cart: state.cart.cart,
    frete: {
        options: state.cart.frete,
        selectedFrete: state.cart.selectedFrete,
        cep: state.cart.cep,
    },
    ownProps
})
export default connect(mapStateToProps, actions)(CheckoutPage)