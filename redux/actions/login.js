/* basic modules************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
import axios from 'axios'
import config from '../../config.js'

/* helpers***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
import { } from '../../helpers/authentication.js'

/* types************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
import { LOGIN, VERIFY_AUTHENTICATION } from '../types.js'
axios.defaults.withCredentials = true

/* return************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
export const sendLoginCredentials = (email, password) => async dispatch => {
  console.log('aqui')
    return await axios.post(`${config.api}/login`, { email, password }, { withCredentials: true }).then(async response => {
      console.log(email, password)
      console.log(response)
      dispatch({
        type: LOGIN,
        payload: response.data
      })

      return await verifyThisAuthentication()

      async function verifyThisAuthentication () {
        if (typeof response.data.authentication !== 'undefined') { return Promise.resolve(true) } else { return Promise.reject() }
      }
    }).catch(error => console.error(error))
  }

const verifyAuthentication = (getInfo = 'false') => async dispatch => {
  await axios.get(`${config.api}/session/${getInfo}`).then(response => {
    dispatch({
      type: VERIFY_AUTHENTICATION, payload: { authentication: response.data }
    })
  }).catch(error => console.error(error))
}

export default {
  sendLoginCredentials,
  verifyAuthentication
}
