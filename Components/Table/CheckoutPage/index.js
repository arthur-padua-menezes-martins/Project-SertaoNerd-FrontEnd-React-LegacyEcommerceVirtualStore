/*basic modules************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
import React, { useState, useEffect } from 'react'

/*redux************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
import { connect } from 'react-redux'
import actions from '../../../redux/actions/index.js'

/*components************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
import DefaultTable from '../Default/index.js'

/*styled components************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
import {
    StyledContainerCheckoutTable,
    StyledArticleCheckoutTable,
    StyledSectionCheckoutTable, StyledSectionOne, StyledSectionTwo, StyledSectionThree
} from './styles.js'

/*helpers************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
import { dollarPayment, reaisPayment } from '../../../helpers/format/index.js'

/*main function************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
function CheckoutTable(props) {

    /*hooks************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
    useEffect(async () => {
        props.setThisCart(props.login.authentication.user_id)
    }, [])


    /*var's************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
    var
        cartTotal = `${((props.cart || []).reduce((acumulator, item) => acumulator + Number(item.unitaryValue) * Number(item.quantity), 0)).toFixed(2) || '...'}`,
        freteValue = `${typeof props.frete.selectedFrete !== 'undefined' && props.frete.selectedFrete.Valor || '---'}`,
        payment = freteValue !== '---' ? (Number(cartTotal) + dollarPayment(freteValue)).toFixed(2) : '---',
        theShopping = [
            [
                {
                    subtotal: reaisPayment(cartTotal),
                    frete: reaisPayment(freteValue)
                }
            ],
            [
                {
                    total: reaisPayment(payment)
                }
            ]
        ]







    /*return************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
    return (
        <StyledContainerCheckoutTable>

            <StyledArticleCheckoutTable cartLenght={props.cart !== null && props.cart.length}>

                {props.cart !== null && props.cart.map((cart, index) => (

                    <StyledSectionCheckoutTable key={index}>

                        <StyledSectionOne>
                            <div>{cart.quantity}</div>
                            <img src={cart.variations.images[0]} />
                        </StyledSectionOne>

                        <StyledSectionTwo>
                            <div>
                                <div>{cart.variations.title}</div>
                                <div>{cart.variations.code}</div>
                            </div>
                        </StyledSectionTwo>

                        <StyledSectionThree>
                            <div>{reaisPayment((cart.unitaryValue * cart.quantity).toFixed(2))}</div>
                        </StyledSectionThree>

                    </StyledSectionCheckoutTable>

                ))}

            </StyledArticleCheckoutTable>


            { !props.whatsapp.whatsappVersion ? (<>

                <div style={{ marginTop: '2rem' }}>
                    <DefaultTable
                        informations={props.cart !== null ? theShopping[0] : []}
                        keyTextAlign={'left'} keyFontSize={1.8}
                        valueTextAlign={'right'} valueFontWeight={500} />
                </div>

                <div style={{ marginTop: '2rem' }}>
                    <DefaultTable
                        informations={props.cart !== null ? theShopping[1] : []}
                        keyTextAlign={'left'} keyFontSize={1.8}
                        valueTextAlign={'right'} valueFontSize={2.2} valueFontWeight={600} />
                </div>

            </>) : (<>
                <div style={{ marginTop: '2rem' }}>
                    <DefaultTable
                        informations={props.cart !== null ? [{ total: reaisPayment(cartTotal) }] : []}
                        keyTextAlign={'left'} keyFontSize={1.8}
                        valueTextAlign={'right'} valueFontSize={2.2} valueFontWeight={600} />
                </div>
            </>)
            }

        </StyledContainerCheckoutTable>
    )
}

const mapStateToProps = (state, ownProps) => ({
    ...state,
    cart: state.cart.cart,
    frete: {
        options: state.cart.frete,
        selectedFrete: state.cart.selectedFrete,
        cep: state.cart.cep,
    },
    ownProps
})
export default connect(mapStateToProps, actions)(CheckoutTable)